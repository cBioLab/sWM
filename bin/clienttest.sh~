#!/bin/bash

quepath="../data/client/"
files=("../data/sWM_etime.dat" "../data/sWM_ctime.dat" "../data/sWM_comsize.dat") 
port=23456
core=2
sigma=(4 8 16 32 64 128 256 512 1024)
host="localhost"

for file in ${files[@]}
do
	rm -f $file
done

for i in ${sigma[@]}
do
	f="$path$i.que"
	if [ ! -e $f ]; then
		echo "error ${f}"
		exit 0
	fi
done

if [ $# != 0 ]; then
	host=$1
	echo $host
fi

for i in ${sigma[@]}
do
	filename="$quepath$i.que"
	n=0
	./client -p $port -f $filename -c $core -h $host | while read line
	do
		echo "$i $line" >> ${files[$n]}
		n=`expr $n + 1`
	done
	port=`expr $port + 1`
	sleep 2s
done
